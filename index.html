<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>repcse</title>
<style>
body{margin:0;font-family:monospace;background:white;color:black;display:flex;justify-content:center;align-items:center;height:100vh;}
#app{width:340px;height:200px;border:1px solid black;display:flex;flex-direction:column;background:white;}
header{padding:3px 5px;border-bottom:1px solid black;font-weight:bold;text-align:center;font-size:14px;}
#screen{flex:1;overflow-y:auto;padding:5px;font-size:12px;}
section{display:none;margin-bottom:5px;}
section p{margin:2px 0;}
nav{display:flex;border-top:1px solid black;font-size:10px;}
nav a{flex:1;text-align:center;padding:2px 0;text-decoration:none;color:black;border-right:1px solid black;pointer-events:none;opacity:0.5;}
nav a:last-child{border-right:none;}
nav a.active{pointer-events:auto;opacity:1;}
a.action{color:blue;cursor:pointer;text-decoration:underline;font-size:11px;}
.message{font-size:10px;margin:2px 0;}
.msg-error{color:red;}
.msg-success{color:green;}
.msg-info{color:blue;}
ul{padding-left:15px;margin:0;}
ul li{margin:1px 0;}
input[type=file]{display:none;}
</style>
</head>
<body>
<div id="app">
<header>repcse</header>
<div id="screen">
  <!-- Home -->
  <section id="mod-home">
    <p><strong>Register / Load</strong></p>
    <input id="signup-password" type="password" maxlength="6" placeholder="Enter password (max 6 digits)">
    <p>
      <a href="#" class="action" onclick="signup()">Sign Up</a> | 
      <a href="#" class="action" onclick="document.getElementById('load-file').click()">Load</a>
    </p>
    <input type="file" id="load-file" accept=".txt" onchange="loadFromFile(event)">
  </section>

  <!-- Shop -->
  <section id="mod-shop">
    <p><strong>Shop</strong></p>
    <div id="shop-items"></div>
  </section>

  <!-- Work -->
  <section id="mod-work">
    <p><strong>Work</strong></p>
    <div>
      <p>Item: <span id="job-item">-</span></p>
      <p>Receiver: <span id="job-receiver">-</span></p>
      <p>Size: <span id="job-size">-</span></p>
      <p>Wage: <span id="job-wage">-</span></p>
    </div>
    <p>
      <a href="#" class="action" onclick="acceptJob()">Accept Job</a> |   
      <a href="#" class="action" onclick="deliverJob()">Deliver Job</a>
    </p>
  </section>

  <!-- Player Data -->
  <section id="mod-data">
    <p><strong>Player Data</strong></p>
    <p>Tag: <span id="player-tag">-</span></p>
    <p>CR: <span id="player-cr">-</span></p>
    <p>Level: <span id="player-level">-</span></p>
    <p>EXP: <span id="player-exp">-</span></p>
    <p>Date: <span id="player-date">-</span></p>
    <p>Buzz: <span id="player-buzz">100%</span></p>
    <p>Total Jobs: <span id="player-totaljobs">0</span></p>
    <p>Inventory:</p>
    <ul id="player-inventory"></ul>
    <p>
      <a href="#" class="action" onclick="resetData()">[reset]</a> |
      <a href="#" class="action" onclick="saveData()">[save]</a> |
      <a href="#" class="action" onclick="document.getElementById('load-data').click()">[load]</a>
    </p>
    <input type="file" id="load-data" accept=".txt" onchange="loadFromFile(event)">
  </section>
</div>

<nav>
  <a href="#" id="nav-home" onclick="showMod('mod-home')">Home</a>
  <a href="#" id="nav-shop" onclick="showMod('mod-shop')">Shop</a>
  <a href="#" id="nav-work" onclick="showMod('mod-work')">Work</a>
  <a href="#" id="nav-data" onclick="showMod('mod-data')">Data</a>
</nav>
</div>

<script>
const navLinks={shop:document.getElementById('nav-shop'),work:document.getElementById('nav-work'),data:document.getElementById('nav-data')};

const shopItems=[{name:'juice', price:3.79, fill:2},{name:'bread', price:1.39, fill:1},{name:'pill', price:1000, fill:100}];

function getPlayer(){return JSON.parse(localStorage.getItem('player')||'null');}
function savePlayer(p){localStorage.setItem('player',JSON.stringify(p));}
function initPlayer(){
  const p=getPlayer();
  if(!p){showMod('mod-home');disableNav();} 
  else{updateUI();enableNav();showMod('mod-data');}
  renderShop();
}
function disableNav(){Object.values(navLinks).forEach(l=>l.classList.remove('active'));}
function enableNav(){Object.values(navLinks).forEach(l=>l.classList.add('active'));}

function signup(){
  const pw=document.getElementById('signup-password').value.trim();
  if(!pw||pw.length>6) return printMessage('Invalid password!','error');
  const tag=String(Math.floor(3+Math.random()*997)).padStart(3,'0');
  const date=new Date().toLocaleDateString();
  const player={tag,password:pw,cr:0,inventory:{},level:1,exp:0,date,buzz:100,totalJobs:0};
  savePlayer(player); printMessage('Registration successful!','success');
  updateUI(); enableNav(); showMod('mod-data');
}

function updateUI(){
  const p=getPlayer(); if(!p) return;
  document.getElementById('player-tag').textContent=p.tag;
  document.getElementById('player-cr').textContent=p.cr.toFixed(2);
  document.getElementById('player-level').textContent=p.level;
  document.getElementById('player-exp').textContent=p.exp;
  document.getElementById('player-date').textContent=p.date;
  document.getElementById('player-buzz').textContent=p.buzz.toFixed(0)+'%';
  document.getElementById('player-totaljobs').textContent=p.totalJobs;

  const invList=document.getElementById('player-inventory'); invList.innerHTML='';
  for(const [item,qty] of Object.entries(p.inventory)){
    const li=document.createElement('li');
    li.innerHTML=`${item} x${qty} <a href="#" class="action" onclick="useItem('${item}')">[use]</a>`;
    invList.appendChild(li);
  }

  if(p.activeJob){
    const j=p.activeJob;
    document.getElementById('job-item').textContent=j.item;
    document.getElementById('job-receiver').textContent=j.receiver;
    document.getElementById('job-size').textContent=j.size;
    document.getElementById('job-wage').textContent=j.wage.toFixed(2)+' cr';
  } else {
    ['job-item','job-receiver','job-size','job-wage'].forEach(id=>document.getElementById(id).textContent='-');
  }
}

function showMod(id){
  document.querySelectorAll('#screen > section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}

function printMessage(msg,type='info'){
  const active=[...document.querySelectorAll('#screen > section')].find(s=>s.style.display!=='none');
  if(!active) return;
  const p=document.createElement('p'); p.textContent=msg; p.className=`message msg-${type}`;
  active.appendChild(p); active.scrollTop=active.scrollHeight; setTimeout(()=>p.remove(),5000);
}

// Shop functions
function renderShop(){
  const c=document.getElementById('shop-items'); c.innerHTML='';
  shopItems.forEach(i=>{
    const p=document.createElement('p');
    p.innerHTML=`${i.name} - ${i.price.toFixed(2)} cr <a href="#" class="action" onclick="buyItem('${i.name}')">Buy</a>`;
    c.appendChild(p);
  });
}
function buyItem(name){
  const p=getPlayer(); const item=shopItems.find(x=>x.name===name);
  if(p.cr<item.price) return printMessage('Not enough CR!','error');
  p.cr-=item.price; p.inventory[name]=(p.inventory[name]||0)+1; savePlayer(p); updateUI(); printMessage(`Bought ${name}`,'success');
}
function useItem(name){
  const p=getPlayer(); if(!p.inventory[name]||p.inventory[name]<=0) return printMessage(`No ${name} to use!`,'error');
  const item=shopItems.find(x=>x.name===name);
  p.buzz=Math.min(100,p.buzz+item.fill); p.inventory[name]--; if(p.inventory[name]<=0) delete p.inventory[name];
  savePlayer(p); updateUI(); printMessage(`${name} used! Buzz +${item.fill}%`,'success');
}

// Work functions
function acceptJob(){
  const sizes=['small','medium','big'];
  const buzzUse={small:1,medium:2,big:3};
  const wages={small:0.5,medium:1.0,big:1.7};
  const player=getPlayer();
  if(player.activeJob) return printMessage('Finish current job first!','error');
  const size=sizes[Math.floor(Math.random()*sizes.length)];
  if(player.buzz<buzzUse[size]) return printMessage('Not enough buzz!','error');
  const item=`parcel-${size}`; const receiver=String(Math.floor(3+Math.random()*997)).padStart(3,'0');
  player.buzz-=buzzUse[size]; player.inventory[item]=(player.inventory[item]||0)+1;
  player.activeJob={item,receiver,size,wage:wages[size]};
  player.exp+=Math.floor(Math.random()*2)+1; if(player.exp>=player.level*7 && player.level<999){player.exp=0;player.level++;}
  savePlayer(player); updateUI(); printMessage(`Job accepted: ${item} to ${receiver}`,'success');
}
function deliverJob(){
  const player=getPlayer(); const job=player.activeJob;
  if(!job) return printMessage('No active job!','error');
  if(!player.inventory[job.item]||player.inventory[job.item]<=0) return printMessage(`You don't have ${job.item}`,'error');
  player.inventory[job.item]--; if(player.inventory[job.item]<=0) delete player.inventory[job.item];
  player.cr+=job.wage; delete player.activeJob; player.totalJobs++;
  savePlayer(player); updateUI(); printMessage(`${job.item} delivered to ${job.receiver}. Earned ${job.wage.toFixed(2)} cr`,'success');
}

// Reset / Save / Load
function resetData(){ if(confirm('Delete all data?')){localStorage.removeItem('player'); location.reload();}}
function saveData(){ 
  const data=getPlayer(); 
  if(!data) return;
  const blob=new Blob([JSON.stringify(data)],{type:'text/plain'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='repcse_data.txt'; a.click();
}
function loadFromFile(e){
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(ev){
    try{
      const data=JSON.parse(ev.target.result);
      localStorage.setItem('player',JSON.stringify(data)); initPlayer(); printMessage('Data loaded successfully!','success');
    }catch(err){printMessage('Invalid file!','error');}
  }
  reader.readAsText(file);
  e.target.value=''; // reset input
}

window.onload=initPlayer;
</script>
</body>
</html>